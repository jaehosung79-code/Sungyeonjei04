<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì—°ì œ ìš´ë™ ì²´í¬ ì•±</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2a7bff">

<!-- iOS ì§€ì› -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
body { font-family:sans-serif; padding:15px; background:#f2f2f2; }
h2 { text-align:center; }

.container {
    background:white; padding:15px; border-radius:10px;
    box-shadow:0 2px 5px rgba(0,0,0,0.15); margin-bottom:15px;
}

.save-btn, .delete-btn, .add-btn {
    padding:10px 15px; font-size:14px;
    border:none; border-radius:8px; cursor:pointer;
}
.save-btn { background:#2a7bff; color:white; width:100%; margin-top:15px; }
.delete-btn { background:#d9534f; color:white; margin-left:10px; }
.add-btn { background:#ff9800; color:white; width:100%; margin-top:10px; }

.date-row { display:flex; align-items:center; }
.date-row input[type="date"] { flex:1; padding:8px; font-size:16px; }

table {
    width: 100%; border-collapse: separate; border-spacing: 0;
    margin-top: 10px; border: 1px solid #ccc; border-radius: 10px; overflow: hidden;
}
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background:#444; color:white; }

/* ë“œë˜ê·¸ */
tr.draggable-row { cursor:move; }
tr.dragging { opacity:0.3; }

footer {
    text-align:center;
    margin-top:20px;
    padding:10px;
    color:#666;
}

#progressContainer {
    background:white; padding:15px; border-radius:10px;
    box-shadow:0 2px 5px rgba(0,0,0,0.15); margin-bottom:15px;
}

/* ì§„ë„ìœ¨ ê°•ì¡° */
#progressPercent {
    color: red;
    font-size: 2em; /* 2ë°° í¬ê¸° */
    font-weight: bold;
}
</style>
</head>
<body>

<h2>ì—°ì œ ìš´ë™ ì²´í¬ ì•±</h2>

<div id="progressContainer">
    <h3>ì´ë²ˆ ë‹¬ ì§„ë„ìœ¨</h3>
    <p id="progressText">
        ì´ë²ˆ ë‹¬ ìš´ë™í•œ ë‚ : <span id="completedDays"></span> / <span id="totalDays"></span>ì¼<br>
        ì§„ë„ìœ¨: <span id="progressPercent"></span>%
    </p>
</div>

<div class="container">
    <!-- ë‚ ì§œ + ì‚­ì œ ë²„íŠ¼ -->
    <div class="date-row">
        <input type="date" id="dateInput" />
        <button class="delete-btn" id="deleteBtn">ğŸ—‘ ì‚­ì œ</button>
    </div>

    <!-- ìš´ë™ ëª©ë¡ -->
    <table id="exerciseTable">
        <thead>
            <tr><th>ìš´ë™</th><th>1set</th><th>2set</th><th>3set</th><th>ì‚­ì œ</th></tr>
        </thead>
        <tbody id="exerciseBody">
            <tr draggable="true" class="draggable-row">
                <td>ë³´ê°•</td>
                <td><input type="checkbox" data-name="bo1"></td>
                <td><input type="checkbox" data-name="bo2"></td>
                <td><input type="checkbox" data-name="bo3"></td>
                <td></td>
            </tr>
            <tr draggable="true" class="draggable-row">
                <td>ì½”ì–´</td>
                <td><input type="checkbox" data-name="core1"></td>
                <td><input type="checkbox" data-name="core2"></td>
                <td><input type="checkbox" data-name="core3"></td>
                <td></td>
            </tr>
            <tr draggable="true" class="draggable-row">
                <td>í‘¸ì‰¬ì—…</td>
                <td><input type="checkbox" data-name="push1"></td>
                <td><input type="checkbox" data-name="push2"></td>
                <td><input type="checkbox" data-name="push3"></td>
                <td></td>
            </tr>
            <tr draggable="true" class="draggable-row">
                <td>ëª¸í†µ ëŒë¦¬ê¸°</td>
                <td><input type="checkbox" data-name="bat1"></td>
                <td><input type="checkbox" data-name="bat2"></td>
                <td><input type="checkbox" data-name="bat3"></td>
                <td></td>
            </tr>
            <tr draggable="true" class="draggable-row">
                <td>ì•…ë ¥ê¸°</td>
                <td><input type="checkbox" data-name="gripL"></td>
                <td><input type="checkbox" data-name="gripR"></td>
                <td></td>
                <td></td>
            </tr>
            <tr draggable="true" class="draggable-row">
                <td>ê³ ë¬´ì¤„ íŠœë¹™</td>
                <td><input type="checkbox" data-name="tubing1"></td>
                <td><input type="checkbox" data-name="tubing2"></td>
                <td><input type="checkbox" data-name="tubing3"></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <button class="add-btn" id="addExerciseBtn">+ ìš´ë™ ì¶”ê°€</button>
    <button id="saveBtn" class="save-btn">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
</div>

<footer>
    ë§Œë“  ì‚¬ëŒ : <strong>Jaeho</strong>
</footer>

<script>
// -------------------- ë³€ìˆ˜ --------------------
const dateInput = document.getElementById("dateInput");
const exerciseBody = document.getElementById("exerciseBody");
const progressText = document.getElementById("progressText");

// ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’
const now = new Date();
const offset = now.getTimezoneOffset() * 60000;
dateInput.value = new Date(Date.now() - offset).toISOString().split("T")[0];

// -------------------- ìš´ë™ ì¶”ê°€ --------------------
document.getElementById("addExerciseBtn").onclick = () => {
    const name = prompt("ì¶”ê°€í•  ìš´ë™ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
    if (!name) return;
    const idBase = name.replace(/\s/g, "");

    const row = document.createElement("tr");
    row.draggable = true;
    row.className = "draggable-row";
    row.innerHTML = `
        <td>${name}</td>
        <td><input type="checkbox" data-name="${idBase}_1"></td>
        <td><input type="checkbox" data-name="${idBase}_2"></td>
        <td><input type="checkbox" data-name="${idBase}_3"></td>
        <td><button onclick="deleteRow(this)">X</button></td>
    `;
    exerciseBody.appendChild(row);
    initDragEvents();
};

// -------------------- í–‰ ì‚­ì œ --------------------
function deleteRow(btn) { btn.closest("tr").remove(); }

// -------------------- ì €ì¥ --------------------
document.getElementById("saveBtn").onclick = () => {
    const key = "exercise_" + dateInput.value;
    let data = {};
    document.querySelectorAll("input[type=checkbox]").forEach(cb => data[cb.dataset.name] = cb.checked);
    localStorage.setItem(key, JSON.stringify(data));
    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    updateMonthlyProgress();
};

// -------------------- ë¶ˆëŸ¬ì˜¤ê¸° --------------------
function loadData(date) {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
    const data = JSON.parse(localStorage.getItem("exercise_" + date) || "{}");
    for (let key in data) {
        const cb = document.querySelector(`[data-name="${key}"]`);
        if (cb) cb.checked = data[key];
    }
}
loadData(dateInput.value);
dateInput.onchange = () => loadData(dateInput.value);

// -------------------- ë‚ ì§œ ì‚­ì œ --------------------
document.getElementById("deleteBtn").onclick = () => {
    const date = dateInput.value;
    if (confirm(date + " ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
        localStorage.removeItem("exercise_" + date);
        document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
        updateMonthlyProgress();
    }
};

// -------------------- ë“œë˜ê·¸ ì •ë ¬ --------------------
function initDragEvents() {
    const rows = document.querySelectorAll(".draggable-row");
    rows.forEach(row => {
        row.addEventListener("dragstart", () => row.classList.add("dragging"));
        row.addEventListener("dragend", () => row.classList.remove("dragging"));
    });
    exerciseBody.addEventListener("dragover", e => {
        e.preventDefault();
        const dragging = document.querySelector(".dragging");
        const after = getDragAfterElement(exerciseBody, e.clientY);
        if (after == null) exerciseBody.appendChild(dragging);
        else exerciseBody.insertBefore(dragging, after);
    });
}
function getDragAfterElement(container, y) {
    const elements = [...container.querySelectorAll(".draggable-row:not(.dragging)")];
    return elements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height/2;
        if (offset < 0 && offset > closest.offset) return {offset, element:child};
        else return closest;
    }, {offset: Number.NEGATIVE_INFINITY}).element;
}
initDragEvents();

// -------------------- í•œ ë‹¬ ì§„ë„ìœ¨ --------------------
function updateMonthlyProgress() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth()+1;
    const totalDays = new Date(year, month, 0).getDate();
    let completedDays = 0;
    for (let i=1; i<=totalDays; i++){
        const day = i.toString().padStart(2,'0');
        const monthStr = month.toString().padStart(2,'0');
        const key = `exercise_${year}-${monthStr}-${day}`;
        if(localStorage.getItem(key)) completedDays++;
    }
    const progress = ((completedDays/totalDays)*100).toFixed(1);
    document.getElementById("completedDays").textContent = completedDays;
    document.getElementById("totalDays").textContent = totalDays;
    document.getElementById("progressPercent").textContent = progress;
}
updateMonthlyProgress();

// -------------------- PWA ë“±ë¡ --------------------
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('service-worker.js')
    .then(()=>console.log('Service Worker ë“±ë¡ë¨'))
    .catch(err=>console.error('Service Worker ë“±ë¡ ì‹¤íŒ¨',err));
}
</script>
</body>
</html>
